@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@model Dictionary<string, List<Movie>>

<!-- Outer container for holding accordian and cards-->
<div class="container mt-4">
    <!-- Accordion (each expander is a category type of movies) -->
    <div class="accordion" id="movieAccordion">

        @foreach (var categoryGroup in Model)
        {
            <!-- Generate accordian id from category name -->
            var categoryId = categoryGroup.Key.Replace(" ", "");

            <!-- Generate an accordion item for each category -->
            <div class="accordion-item">

                <!-- Category Header -->
                <h2 class="accordion-header" id="heading-@categoryId">
                    <button class="accordion-button collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapse-@categoryId">
                        @categoryGroup.Key
                    </button>
                </h2>

                <!-- Expandable Body -->
                <div id="collapse-@categoryId"
                     class="accordion-collapse collapse"
                     data-bs-parent="#movieAccordion">

                    <div class="accordion-body">

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

                            <!-- Populate the body with alphabetically organized movie cards -->
                            @foreach (var movie in categoryGroup.Value)
                            {
                                <div class="col">
                                    <!-- The card -->
                                    <div class="card h-100 shadow-sm">

                                        <div class="card-body">

                                            <h5 class="card-title mb-1">@movie.Title</h5>

                                            <!-- All info on the movie is displayed from here down -->
                                            <p class="text-muted mb-2">
                                                @movie.Year • Rated @movie.Rating
                                            </p>

                                            <!-- All the if statements are jsut ensuring the field isn't null -->
                                            @if (movie.Director != null)
                                            {
                                                <p class="mb-1">
                                                    <strong>Director:</strong> @movie.Director
                                                </p>
                                            }

                                            <p class="mb-1">
                                                <strong>Edited:</strong>
                                                @if (movie.Edited == true)
                                                {
                                                    <span class="badge bg-warning text-dark">Yes</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-success">No</span>
                                                }
                                            </p>

                                            <p class="mb-1">
                                                <strong>Copied to Plex:</strong>
                                                @if (movie.CopiedToPlex == true)
                                                {
                                                    <span class="badge bg-warning text-dark">Yes</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-success">No</span>
                                                }
                                            </p>

                                            @if (movie.LentTo != null)
                                            {
                                                <p class="mb-1">
                                                    <strong>Lent To:</strong> @movie.LentTo
                                                </p>
                                            }

                                            @if (movie.Notes != null)
                                            {
                                                <p class="mt-2">
                                                    <strong>Notes:</strong><br />
                                                    <small class="text-muted">@movie.Notes</small>
                                                </p>
                                            }

                                            <div class="mt-3 d-flex justify-content-between">

                                                <!-- Edit Button -->
                                                <a asp-controller="Home"
                                                   asp-action="EditMovie"
                                                   asp-route-id="@movie.MovieId"
                                                   class="btn btn-sm btn-outline-primary">
                                                    Edit
                                                </a>

                                                <!-- Delete Button -->
                                                <form asp-controller="Home"
                                                      asp-action="DeleteMovie"
                                                      asp-route-id="@movie.MovieId"
                                                      method="post"
                                                      onsubmit="return confirm('Are you sure you want to delete this movie?');">

                                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                                        Delete
                                                    </button>

                                                </form>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                            }

                        </div>

                    </div>
                </div>

            </div>
        }
    </div>
</div>